{% extends '../dashboard/utils/layout.html' %}
{% load static %}
{% load i18n %}
{% block content %}

<style>
    .invoice {
        padding: 1.2rem;
        border: 1px solid #dddddd;
        background-color: #fff;
    }
    .invoice-header {
        text-align: center;
        background-color: rgb(72, 72, 72);
        margin-block: .4rem;
        padding-block: .6rem;
        color: #f2f2f2;
    }
    .invoice-content.flex {
        justify-content: space-between;
        margin-block: 1.6rem;
    }

    .invoice-section.right {
        text-align: right;
    }
    .invoice-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    .invoice-table th, .invoice-table td {
        border: 1px solid #dddddd;
        padding: 10px;
        text-align: left;
    }
    .invoice-table tr:hover,
    .invoice-table tr {
        border: 0;
        background-color: #fff !important;
    }
    .invoice-table th {
        background-color: #f2f2f2;
    }
    .invoice-total {
        text-align: right;
    }

    .action-btns .btn {
        margin-inline: 0;
        background-color: inherit;
        color: #5a5a5a;
        border: 1px solid #f2f2f2;
    }

    /* body {
    font-family: Arial, sans-serif;
    background-color: #f1f1f1;
    }

    .container {
        max-width: 500px;
        margin: 0 auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 5px;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    }

    h1 {
        text-align: center;
    } */

    .form-group {
        margin-bottom: 20px;
    }

    label {
        display: block;
        font-weight: bold;
        margin-bottom: 5px;
    }

    input[type="text"],
    select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 3px;
        font-size: 16px;
    }

    button {
        display: block;
        width: 100%;
        padding: 10px;
        background-color: #4CAF50;
        color: #fff;
        border: none;
        border-radius: 3px;
        font-size: 16px;
        cursor: pointer;
    }

    button:hover {
        background-color: #45a049;
    }

</style>

<div class="main-content" style="overflow-y: scroll;">
    <div class="cs-content-area cs-no-box-shadow outlined" style="block-size: auto;padding: .6rem .4rem;">
        <div class="content-area-top flex" style="justify-content: space-between;padding-block-start: .4rem;">
            <h3 style="font-weight:600;">{% trans 'Invoices & Payment' %}</h3>
            <!-- <h4>Mark all as read</h4> -->
        </div>

        <div class="notifications-section flex" style="background-color: rgb(226, 226, 224);">
            <h4 class="section-togglers" data-section="sec_00" style="padding-block: 1.2rem;">Invoice Management</h4>
            <h4 class="section-togglers" data-section="sec_01" style="padding-block: 1.2rem;">Payment Methods</h4>
            <h4 class="section-togglers" data-section="sec_02" style="padding-block: 1.2rem;">Payment History</h4>
            <!-- <h4 class="section-togglers" data-section="sec_03" style="padding-block: 1.2rem;">Accounts Payable</h4> -->
        </div>

        <div class="notification-section inview" id="sec_00">
            <table id="invoices-table" class="display" style="width:100%;margin-top:.5rem;">
                <thead>
                    <tr>
                        <th>Invoice #</th>
                        <th>Invoice Date</th>
                        <th>Due Date</th>
                        <th>Total</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <div class="notification-section" id="sec_01">
            <div class="section-wrapper">
                <div class="container">
                    <form>
                        <div class="form-group">
                            <label for="payment-method">Payment Method:</label>
                            <select id="payment-method">
                                <option value="credit-card">Credit Card</option>
                                <option value="paypal">PayPal</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="card-number">Card Number:</label>
                            <input type="text" id="card-number" placeholder="Enter your card number">
                        </div>
                        <div class="form-group">
                            <label for="expiry-date">Expiry Date:</label>
                            <input type="text" id="expiry-date" placeholder="MM/YY">
                        </div>
                        <div class="form-group">
                            <label for="cvv">CVV:</label>
                            <input type="text" id="cvv" placeholder="CVV">
                        </div>
                        <button type="submit">Save Payment Method</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="notification-section" id="sec_02">
            <div class="section-wrapper">
                <table id="payment-history-table" class="display" style="width:100%;margin-top:.5rem;">
                    <thead>
                        <tr>
                            <th>Receipt #</th>
                            <th>Item</th>
                            <th>Quantity</th>
                            <th>Unit Price</th>
                            <th>Total</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>123456</td>
                            <td>Reizhen Smart Wrist Ban</td>
                            <td>1</td>
                            <td>$670</td>
                            <td>$670</td>
                            <td>03-08-2023</td>
                        </tr>
                        <tr>
                            <td>123000</td>
                            <td>TP-Link Router CTX-04</td>
                            <td>2</td>
                            <td>$800</td>
                            <td>$1,600</td>
                            <td>24-07-2023</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- <div class="notification-section" id="sec_03">
            <div class="section-wrapper"></div>
        </div> -->
        <div class="notification-section" id="sec_04">
            <div class="section-wrapper">
                <div class="invoice">
                    <div class="invoice-header">
                        <h3>Invoice #1253578</h3>
                        <h5>PAID</h5>
                    </div>

                    <div class="flex invoice-content">
                        <div class="invoice-section">
                            <h3>Pay To</h3>
                            <p>
                                Aztecs Inc.<br>
                                Frique Internet Group UG<br>
                                108 Rwenzori Street<br>
                                Kampala 19801
                            </p>
                        </div>
        
                        <div class="invoice-section right">
                            <h3>Invoiced To</h3>
                            <p>
                                Abdoulanziz Ally<br>
                                William Street, Bombo Road<br>
                                Kampala, Central, 00000<br>
                                Uganda
                            </p>
                        </div>
                    </div>

                    <div class="flex invoice-content">
                        <div class="invoice-section">
                            <h3>Payment Method</h3>
                            <p>Credit or Debit Card (Visa-6764)</p>
                        </div>
        
                        <div class="invoice-section right">
                            <h3>Invoice Date</h3>
                            <p>07/27/2023</p>
                        </div>
                    </div>
                
                    <h3>Invoice Items</h3>
                    <table class="invoice-table">
                        <tr>
                            <th>Description</th>
                            <th>Amount</th>
                        </tr>
                        <tr>
                            <td>Product Purchase: Gold Riezhen - Smart Watches<br>
                                Durable Gold sleek watches for both children and adults. Made for high end markets such as East Asia.
                            </td>
                            <td>$26.00</td>
                        </tr>
                        <tr>
                            <td><strong>Sub Total</strong></td>
                            <td><strong>$26.00</strong></td>
                        </tr>
                        <tr>
                            <td>Credit</td>
                            <td>$0.00</td>
                        </tr>
                        <tr>
                            <td><strong>Total</strong></td>
                            <td><strong>$26.00</strong></td>
                        </tr>
                    </table>
                    
                    <h3>Transaction Details</h3>
                    <table class="invoice-table">
                        <tr>
                            <th>Transaction Date</th>
                            <th>Gateway</th>
                            <th>Transaction ID</th>
                            <th>Amount</th>
                        </tr>
                        <tr>
                            <td>07/27/2023</td>
                            <td>Credit or Debit Card</td>
                            <td>txn_3MmdJBK4kABOIfpm15KO5mpX</td>
                            <td>$26.00</td>
                        </tr>
                    </table>
                    
                    <div class="invoice-total" style="margin-block-start: .6rem;">
                        <h3>Balance</h3>
                        <p>$0.00</p>
                    </div>

                    <div class="action-btns" style="text-align: right;margin-block-start: 1.2rem;">
                        <a href="javascript:window.print()" class="btn"><i class="ti-printer"></i> Print</a>
                        <a href="#" class="btn"><i class="ti-download"></i> Download</a>
                    </div>
                
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    

    // Populate form for editing
    function preloadDataForEditing(data, form) {
        const formElement = document.querySelector(`#${form}`).querySelector("form");
        for (const field of formElement.elements) {
            if (['INPUT', 'SELECT', 'TEXTAREA'].includes(field.tagName)) {
            const fieldName = field.name;
            const fieldValue = JSON.parse(data)[fieldName];

            if (fieldValue !== undefined) {
                field.value = fieldValue;
            }
            }
        }
    }

    // Capitalize each word and add spaces to field names
    function formatFieldName(fieldName) {
        return fieldName
            .replace(/([a-z])([A-Z])/g, '$1 $2') // Add space between camel case
            .replace(/\b\w/g, firstChar => firstChar.toUpperCase()); // Capitalize each word
    }


    // // Generate dynamic form
    // function generateForm(doc) {
    //     const formContainer = document.querySelector("#sec_01 .section-wrapper");
    //     formContainer.innerHTML = "";
    //     const form = document.createElement("form");

    //     const keys = Object.keys(doc);
    //     const numFields = keys.length;

    //     keys.forEach((key, index) => {
    //         // Skip the last field (index starts from 0)
    //         if (index === numFields - 1) {
    //             return;
    //         }

    //         const formattedFieldName = formatFieldName(key);
    //         const value = doc[key];

    //         const formGroup = document.createElement("div");
    //         formGroup.classList.add("form-group");

    //         // Change the label for the first field to "Reference"
    //         const label = document.createElement("label");
    //         label.textContent = index === 0 ? "Reference" : formattedFieldName;
    //         formGroup.appendChild(label);

    //         // Use <textarea> if characters in the field are more than 200
    //         const input = document.createElement(value.length > 200 ? "textarea" : "input");

    //         if (key === "completitionStatus") {
    //             // Create a dropdown for the "Completion Status" field
    //             const select = document.createElement("select");
    //             const statusOptions = ["PENDING", "IN PROGRESS", "COMPLETED", "ON HOLD", "CANCELLED"];

    //             statusOptions.forEach(option => {
    //                 const optionElement = document.createElement("option");
    //                 optionElement.textContent = option;
    //                 select.appendChild(optionElement);
    //             });

    //             // Set the default value as "Pending"
    //             select.value = doc["completitionStatus"];

    //             // Add event listener to the "select" element
    //             select.addEventListener("change", async() => {
    //                 const confirmed = window.confirm("Are you sure you want to change the Completion Status?");
                    
    //                 if (confirmed) {
    //                     doc[key] = select.value;
    //                     const id = doc["_id"];
    //                     const status = select.value;
    //                     doc.status = status;
    //                     const response = await API.requests.updateRequestStatus(id, {"data": doc});

    //                     if(response){
    //                         // const requestsTable = $('#requests-table').DataTable();
    //                         // requestsTable.draw();
    //                         // console.log(requestsTable)
    //                     }
    //                 } else {
    //                     // Revert the value back to the original value if user cancels
    //                     select.value = doc[key];
    //                 }
    //             });

    //             // Append the dropdown to the form group
    //             formGroup.appendChild(select);
    //         } else {
    //             if (value.length > 200) {
    //                 if (value.startsWith("uploads/")) {
    //                     // input.textContent = value;
    //                 } else {
    //                     input.textContent = value;
    //                     input.setAttribute("readonly", true);
    //                 }
    //             } else {
    //                 if (value.startsWith("uploads/")) {
    //                     // File downloads
    //                     input.setAttribute("type", "text");
    //                     input.setAttribute("value", value);

    //                     const downloadLink = document.createElement("a");
    //                     downloadLink.textContent = "Download File";

    //                     // Set the download link's href to the file URL
    //                     downloadLink.setAttribute("href", `#`);
    //                     downloadLink.setAttribute("download", value); // Set the file name with extension
    //                     downloadLink.addEventListener("click", event => {
    //                         event.preventDefault();

    //                         // Fetch the file as a Blob
    //                         fetch(`http://localhost:5000/uploads/file/${value}`)
    //                         .then(response => response.blob()) // Use response.blob() instead of response.json()
    //                         .then(blob => {
    //                             // Create a temporary anchor element to trigger the file download
    //                             const url = URL.createObjectURL(blob);
    //                             const a = document.createElement('a');
    //                             a.href = url;
    //                             a.download = value; // Set the file name here
    //                             a.click();

    //                             // Clean up the temporary URL object
    //                             URL.revokeObjectURL(url);
    //                         })
    //                         .catch(error => console.error(error));
    //                     });
    //                     formGroup.appendChild(downloadLink);
    //                 } else {
    //                     input.setAttribute("type", "text");
    //                     input.setAttribute("value", value);
    //                     input.setAttribute("readonly", true);
    //                 }
    //             }
    //             formGroup.appendChild(input);
    //         }

    //         form.appendChild(formGroup);
    //     });

    //     formContainer.appendChild(form);
    // }






    // Section Togglers
    function sectionToggler(trigger, dataAttrName, parseData = false, dynamicForm = false, dynamicFormData = null){
        const dataSection = trigger.dataset[dataAttrName];
        const sectionToShow = document.querySelector(`#${dataSection}`);
        
        const addSection = () => {
            if (sectionToShow) {
                sectionToShow.classList.add("inview");
            }
        };
        
        const removeVisibleSections = () => {
            const visibleSections = document.querySelectorAll(".notification-section.inview");
            visibleSections.forEach(section => section.classList.remove("inview"));
        };

        trigger.addEventListener("click", () => {
            removeVisibleSections();
            addSection();
            console.log(trigger.dataset)
        });
    }

    document.addEventListener("DOMContentLoaded", () => {
        const section_togglers = document.querySelectorAll(".section-togglers")
        section_togglers.forEach(
            activator => activator.addEventListener("click", () => {
                let sectionToShow = document.querySelector(`#${activator.dataset.section}`)

                section_togglers.forEach(section_toggler => {
                    section_toggler.style.borderBlockEnd = "unset";
                    section_toggler.style.color = "#929293";
                })
                activator.style.color = "#363637";
                activator.style.borderBlockEnd = "2px solid #363637";
                
                let openSections = document.querySelectorAll(".notification-section.inview");
                openSections.forEach(section => section.classList.remove("inview"))

                sectionToShow.classList.add("inview")
            })
        );




        // Fetch data from the network
        async function fetchAllInvoices() {
            // const response = await API.requests.fetchAllRequests();
            // return response.results;
            const results = [
                {
                    "id": "123456",
                    "date": "25-12-23",
                    "dueDate": "25-12-23",
                    "total": "$900",
                    "status": "Paid"
                }
            ];

            console.log(results);
            return results;
        }


        // Load data to the DOM
        (async function loadInvoicesDataToDOM() {
            try {
                const data = await fetchAllInvoices();

                console.log(data)


                const invoicesTableBody = document.querySelector("#invoices-table").querySelector("tbody");
                data.forEach((invoice, index) => {
                    const row = document.createElement("tr");
                    
                    row.style.cursor = "pointer";
                    row.dataset.invoice = JSON.stringify(invoice);
                    
                    row.classList.add("section-toggler");
                    row.dataset.section = "sec_04";

                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${invoice.date}</td>
                        <td>${invoice.dueDate}</td>
                        <td>${invoice.total}</td>
                        <td>${invoice.status}</td>
                    `;

                    let sectionToShow = document.querySelector(`#${row.dataset.section}`);
                    sectionToShow.dataset.invoice = row.dataset.invoice;
                    
                    invoicesTableBody.appendChild(row);

                    // // Open edit form when row is clicked
                    sectionToggler(trigger=row, dataAttrName="section", parseData=true, dynamicForm = true, dynamicFormData = invoice);

                });


                // Set up invoices table
                $('#invoices-table').DataTable();

            } catch (error) {
                // Handle any errors that occurred during the fetch
                console.error('Error fetching data:', error);
            }
        })();


        $('#payment-history-table').DataTable();


        // const invoicesTable = $('#invoices-table').DataTable();






















        // // Fetch notifications
        // async function fetchAllNotifications() {
        //     try {
        //         let endpoint;

        //         if (window.location.hostname === 'localhost') {
        //             endpoint = 'http://localhost:8000/en/api/notifications/';
        //         } else {
        //             endpoint = 'https://foroden.com/en/api/notifications/';
        //         }

        //         const response = await fetch(endpoint);
        //         if (!response.ok) {
        //             throw new Error('Failed to fetch notifications');
        //         }

        //         const notifications = await response.json();

        //         const div = document.querySelector("#sec_00");
        //         if(notifications.results.length != 0){
        //             notifications.results.forEach(notification => {
        //                 div.innerHTML += `
        //                 <div class="notification flex">
        //                         <img src="{% static 'assets/imgs/resources/profiledefault.png' %}" alt="" class="avatar">
        //                         <div class="notification-content">
        //                             <h6 class="notification-title">${notification.title}</h6>
        //                             <span class="notification-time">${notification.description}</span>
        //                             <span class="notification-time">${notification.created_on}</span>
        //                         </div>
        //                     </div>
        //                 `;
        //             });
        //         }else{
        //             div.innerHTML += `
        //             <div style="background-color: #f2f2f2; padding: 20px; border-radius: 8px; text-align: center;">
        //                 <h4 style="color: #888888; font-size: 18px;">Nothing to show - yet</h4>
        //             </div>
        //             `;
        //         }

        //     } catch (error) {
        //         console.error('Error:', error.message);
        //         // Handle the error gracefully
        //     }
        // };

        // // Fetch notifications by category
        // async function fetchNotifications(category, outputDivID) {
        //     try {
        //         let endpoint;

        //         if (window.location.hostname === 'localhost') {
        //             endpoint = `http://localhost:8000/en/api/notifications/${category}`;
        //         } else {
        //             endpoint = `https://foroden.com/en/api/notifications/${category}`;
        //         }

        //         const response = await fetch(endpoint);
        //         if (!response.ok) {
        //             throw new Error('Failed to fetch notifications');
        //         }

        //         const notifications = await response.json();

        //         const div = document.querySelector(`#${outputDivID}`);
        //         if(notifications.results.length != 0){
        //             notifications.results.forEach(notification => {
        //                 div.innerHTML += `
        //                 <div class="notification flex">
        //                         <img src="{% static 'assets/imgs/resources/profiledefault.png' %}" alt="" class="avatar">
        //                         <div class="notification-content">
        //                             <h6 class="notification-title">${notification.title}</h6>
        //                             <span class="notification-time">${notification.description}</span>
        //                             <span class="notification-time">${notification.created_on}</span>
        //                         </div>
        //                     </div>
        //                 `;
        //             });
        //         }else{
        //             div.innerHTML += `
        //             <div style="background-color: #f2f2f2; padding: 20px; border-radius: 8px; text-align: center;">
        //                 <h4 style="color: #888888; font-size: 18px;">Nothing to show - yet</h4>
        //             </div>
        //             `;
        //         }

        //     } catch (error) {
        //         console.error('Error:', error.message);
        //         // Handle the error gracefully
        //     }
        // };

        // fetchAllNotifications();
        // fetchNotifications("CONTRACTS", "sec_01");
        // fetchNotifications("BIDS", "sec_02");
        // fetchNotifications("CHATS", "sec_03");
    
    });
</script>




{{ category_group|json_script:"category_group" }}

{% endblock %}